# AmWine Backend

–ë—ç–∫–µ–Ω–¥ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –≤–∏–Ω AmWine Sommelier AI.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ api/              # REST API –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ main.py           # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ database.py       # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ config.py         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ test_api.sh       # –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ README.md         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
‚îú‚îÄ‚îÄ ml/
‚îÇ   ‚îî‚îÄ‚îÄ recsys/      # ML –º–æ–¥–µ–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îú‚îÄ‚îÄ db/              # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql           # –°—Ö–µ–º–∞ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ create_database.py   # –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ db_config.py         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ update_products.py   # –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ migrations/          # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ .env             # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ requirements.txt # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:
```bash
DB_NAME=amwine_products
DB_USER=postgres
DB_HOST=localhost
DB_PORT=5432
DB_PASSWORD=postgres
```

## –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd db
python create_database.py
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤

```bash
cd db
python update_products.py /path/to/products.json
```

## API

### –ó–∞–ø—É—Å–∫ API

```bash
uvicorn api.main:app --reload --host 0.0.0.0 --port 8000
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [api/README.md](api/README.md)

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

**POST /offers/recommend** - –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–≤–∏–∑–∞

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "occasion": "üéâ –í–µ—á–µ—Ä–∏–Ω–∫–∞",
  "style": "üå§ –õ–µ–≥–∫–æ –∏ –º—è–≥–∫–æ",
  "drink_types": ["üç∑ –í–∏–Ω–æ / –∏–≥—Ä–∏—Å—Ç–æ–µ"],
  "tastes": ["üçë –§—Ä—É–∫—Ç–æ–≤–æ–µ / –∞—Ä–æ–º–∞—Ç–Ω–æ–µ"],
  "people_count": 6,
  "budget": "üí∞ 1000‚Äì3000 ‚ÇΩ"
}
```

–û—Ç–≤–µ—Ç: –º–∞—Å—Å–∏–≤ –∏–∑ 10 —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

**GET /** - Health check

**GET /health** - Health check –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
cd api
./test_api.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —Å curl:
```bash
curl -X POST "http://localhost:8000/offers/recommend" \
  -H "Content-Type: application/json" \
  -d '{
    "occasion": "üéâ –í–µ—á–µ—Ä–∏–Ω–∫–∞",
    "style": "üå§ –õ–µ–≥–∫–æ –∏ –º—è–≥–∫–æ",
    "drink_types": ["üç∑ –í–∏–Ω–æ / –∏–≥—Ä–∏—Å—Ç–æ–µ"],
    "tastes": ["üçë –§—Ä—É–∫—Ç–æ–≤–æ–µ / –∞—Ä–æ–º–∞—Ç–Ω–æ–µ"],
    "people_count": 6,
    "budget": "üí∞ 1000‚Äì3000 ‚ÇΩ"
  }'
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:
- `products` - —Ç–æ–≤–∞—Ä—ã (–≤–∏–Ω–∞)
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `sessions` - —Å–µ—Å—Å–∏–∏ –∫–≤–∏–∑–æ–≤
- `session_quiz` - –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∫–≤–∏–∑–∞
- `session_feedback` - –ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
- `session_cart` - –∫–æ—Ä–∑–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –±–∞–∑—ã
- ML-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–≤–∏–∑–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –º–æ–¥—É–ª—å `ml/recsys`
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (allow all origins). –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —É–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
